// (C) 2025-2026 GoodData Corporation

import type { IDualConfiguration, IPackage } from "../types.js";

const sonarjsPlugin: IPackage = {
    name: "eslint-plugin-sonarjs",
    version: "3.0.6",
};

const commonRules = {
    // we don't mind duplicate string most of the time as they are often checked by TypeScript unions
    "sonarjs/no-duplicate-string": "off",
    // some of these findings are not actionable in a reasonable time
    "sonarjs/cognitive-complexity": "warn",

    "sonarjs/todo-tag": "warn",

    // todo: turn these back on and fix them globally
    "sonarjs/no-hardcoded-passwords": "off",
    "sonarjs/no-alphabetical-sort": "off",
    "sonarjs/no-os-command-from-path": "off",
    "sonarjs/os-command": "off",
    "sonarjs/prefer-regexp-exec": "off",
    "sonarjs/no-clear-text-protocols": "off",
    "sonarjs/deprecation": "off",
    "sonarjs/no-nested-conditional": "off",
    "sonarjs/no-ignored-exceptions": "off",
    "sonarjs/slow-regex": "off",
    "sonarjs/prefer-read-only-props": "off",
    "sonarjs/no-skipped-tests": "off",
    "sonarjs/no-commented-code": "off",
    "sonarjs/no-ignored-return": "off",
    "sonarjs/array-callback-without-return": "off",
    "sonarjs/pseudo-random": "off",
    "sonarjs/no-nested-functions": "off",
    "sonarjs/no-async-constructor": "off",
    "sonarjs/assertions-in-tests": "off",
    "sonarjs/function-return-type": "off",
    "sonarjs/no-unused-vars": "off",
    "sonarjs/no-invariant-returns": "off",
    "sonarjs/different-types-comparison": "off",
    "sonarjs/no-selector-parameter": "off",
    "sonarjs/anchor-precedence": "off",
    "sonarjs/redundant-type-aliases": "off",
    "sonarjs/no-redundant-optional": "off",
    "sonarjs/reduce-initial-value": "off",
    "sonarjs/no-globals-shadowing": "off",
    "sonarjs/use-type-alias": "off",
    "sonarjs/void-use": "off",
    "sonarjs/no-undefined-argument": "off",
    "sonarjs/no-useless-react-setstate": "off",
    "sonarjs/no-inverted-boolean-check": "off",
    "sonarjs/concise-regex": "off",
    "sonarjs/no-dead-store": "off",
    "sonarjs/public-static-readonly": "off",
    "sonarjs/code-eval": "off",
    "sonarjs/no-misleading-array-reverse": "off",
    "sonarjs/fixme-tag": "off",
    "sonarjs/argument-type": "off",
    "sonarjs/constructor-for-side-effects": "off",
    "sonarjs/no-useless-intersection": "off",
    "sonarjs/no-empty-test-file": "off",
    "sonarjs/prefer-default-last": "off",
    "sonarjs/prefer-promise-shorthand": "off",
    "sonarjs/no-unsafe-unzip": "off",
    "sonarjs/no-nested-assignment": "off",
    "sonarjs/generator-without-yield": "off",
    "sonarjs/no-try-promise": "off",
    "sonarjs/single-character-alternation": "off",
    "sonarjs/class-name": "off",
    "sonarjs/no-hardcoded-secrets": "off",
    "sonarjs/regex-complexity": "off",
    "sonarjs/post-message": "off",
    "sonarjs/link-with-target-blank": "off",
    "sonarjs/duplicates-in-character-class": "off",
    "sonarjs/arguments-order": "off",
    "sonarjs/empty-string-repetition": "off",
    "sonarjs/table-header": "off",
    "sonarjs/no-implicit-global": "off",
    "sonarjs/no-control-regex": "off",
};

const overrides = [
    {
        files: ["*.test.ts", "*.test.tsx", "*.spec.ts"],
        rules: {
            // we do not care about duplicate functions in test files, they often make sense (e.g. in different describe blocks)
            "sonarjs/no-identical-functions": "off",
        },
    },
];

export const sonarjs: IDualConfiguration<"sonarjs"> = {
    v8: {
        packages: [sonarjsPlugin],
        plugins: ["sonarjs"],
        extends: ["plugin:sonarjs/recommended-legacy"],
        rules: commonRules,
        overrides,
    },
    v9: {
        packages: [sonarjsPlugin],
        plugins: { sonarjs: sonarjsPlugin },
        // todo: add settings: { react: { version: '999.999.999' } } after checking react config
        rules: {
            "sonarjs/function-name": "off",
            "sonarjs/class-name": "error",
            "sonarjs/max-lines": "off",
            "sonarjs/no-tab": "off",
            "sonarjs/variable-name": "off",
            "sonarjs/comment-regex": "off",
            "sonarjs/no-commented-code": "error",
            "sonarjs/elseif-without-else": "off",
            "sonarjs/no-fallthrough": "error",
            "sonarjs/nested-control-flow": "off",
            "sonarjs/too-many-break-or-continue-in-loop": "off",
            "sonarjs/max-lines-per-function": "off",
            "sonarjs/no-nested-incdec": "off",
            "sonarjs/no-equals-in-for-termination": "error",
            "sonarjs/no-extra-arguments": "error",
            "sonarjs/no-collapsible-if": "off",
            "sonarjs/expression-complexity": "off",
            "sonarjs/no-redundant-parentheses": "off",
            "sonarjs/no-labels": "error",
            "sonarjs/no-nested-assignment": "error",
            "sonarjs/no-redundant-boolean": "error",
            "sonarjs/prefer-single-boolean-return": "error",
            "sonarjs/unused-import": "error",
            "sonarjs/fixme-tag": "error",
            "sonarjs/todo-tag": "error",
            "sonarjs/useless-string-operation": "off",
            "sonarjs/no-unused-function-argument": "off",
            "sonarjs/no-duplicate-string": "off",
            "sonarjs/no-case-label-in-switch": "error",
            "sonarjs/no-parameter-reassignment": "error",
            "sonarjs/prefer-while": "error",
            "sonarjs/no-sonar-comments": "off",
            "sonarjs/no-small-switch": "error",
            "sonarjs/no-hardcoded-ip": "error",
            "sonarjs/label-position": "error",
            "sonarjs/public-static-readonly": "error",
            "sonarjs/file-header": "off",
            "sonarjs/call-argument-line": "error",
            "sonarjs/max-switch-cases": "error",
            "sonarjs/no-unused-vars": "error",
            "sonarjs/prefer-immediate-return": "off",
            "sonarjs/function-inside-loop": "error",
            "sonarjs/code-eval": "error",
            "sonarjs/no-variable-usage-before-declaration": "off",
            "sonarjs/future-reserved-words": "error",
            "sonarjs/array-constructor": "off",
            "sonarjs/bitwise-operators": "error",
            "sonarjs/no-function-declaration-in-block": "off",
            "sonarjs/no-primitive-wrappers": "error",
            "sonarjs/for-in": "off",
            "sonarjs/cyclomatic-complexity": "off",
            "sonarjs/no-skipped-tests": "error",
            "sonarjs/no-identical-expressions": "error",
            "sonarjs/no-nested-switch": "off",
            "sonarjs/constructor-for-side-effects": "error",
            "sonarjs/no-dead-store": "error",
            "sonarjs/no-identical-conditions": "error",
            "sonarjs/no-duplicated-branches": "error",
            "sonarjs/deprecation": "error",
            "sonarjs/no-inverted-boolean-check": "error",
            "sonarjs/misplaced-loop-counter": "error",
            "sonarjs/no-nested-functions": "error",
            "sonarjs/no-hardcoded-passwords": "error",
            "sonarjs/sql-queries": "error",
            "sonarjs/insecure-cookie": "error",
            "sonarjs/no-useless-increment": "error",
            "sonarjs/no-globals-shadowing": "error",
            "sonarjs/no-undefined-assignment": "off",
            "sonarjs/no-empty-test-file": "error",
            "sonarjs/no-ignored-return": "error",
            "sonarjs/no-wildcard-import": "off",
            "sonarjs/arguments-order": "error",
            "sonarjs/pseudo-random": "error",
            "sonarjs/for-loop-increment-sign": "error",
            "sonarjs/cookies": "off",
            "sonarjs/null-dereference": "error",
            "sonarjs/no-selector-parameter": "error",
            "sonarjs/updated-loop-counter": "error",
            "sonarjs/block-scoped-var": "error",
            "sonarjs/no-built-in-override": "off",
            "sonarjs/prefer-object-literal": "off",
            "sonarjs/no-ignored-exceptions": "error",
            "sonarjs/no-gratuitous-expressions": "error",
            "sonarjs/file-uploads": "error",
            "sonarjs/file-permissions": "error",
            "sonarjs/no-empty-character-class": "error",
            "sonarjs/no-unenclosed-multiline-block": "error",
            "sonarjs/index-of-compare-to-positive-number": "error",
            "sonarjs/assertions-in-tests": "error",
            "sonarjs/no-implicit-global": "error",
            "sonarjs/no-useless-catch": "error",
            "sonarjs/xml-parser-xxe": "error",
            "sonarjs/non-existent-operator": "error",
            "sonarjs/web-sql-database": "off",
            "sonarjs/post-message": "error",
            "sonarjs/no-array-delete": "error",
            "sonarjs/no-alphabetical-sort": "error",
            "sonarjs/no-incomplete-assertions": "error",
            "sonarjs/no-global-this": "error",
            "sonarjs/new-operator-misuse": "error",
            "sonarjs/no-delete-var": "error",
            "sonarjs/strings-comparison": "off",
            "sonarjs/file-name-differ-from-class": "off",
            "sonarjs/cookie-no-httponly": "error",
            "sonarjs/no-nested-conditional": "error",
            "sonarjs/no-incorrect-string-concat": "off",
            "sonarjs/different-types-comparison": "error",
            "sonarjs/inverted-assertion-arguments": "error",
            "sonarjs/shorthand-property-grouping": "off",
            "sonarjs/updated-const-var": "error",
            "sonarjs/arguments-usage": "off",
            "sonarjs/destructuring-assignment-syntax": "off",
            "sonarjs/no-invariant-returns": "error",
            "sonarjs/arrow-function-convention": "off",
            "sonarjs/class-prototype": "off",
            "sonarjs/generator-without-yield": "error",
            "sonarjs/no-require-or-define": "off",
            "sonarjs/no-associative-arrays": "error",
            "sonarjs/comma-or-logical-or-case": "error",
            "sonarjs/no-redundant-jump": "error",
            "sonarjs/inconsistent-function-call": "error",
            "sonarjs/no-use-of-empty-return-value": "error",
            "sonarjs/enforce-trailing-comma": "off",
            "sonarjs/void-use": "error",
            "sonarjs/operation-returning-nan": "off",
            "sonarjs/values-not-convertible-to-numbers": "off",
            "sonarjs/non-number-in-arithmetic-expression": "off",
            "sonarjs/cognitive-complexity": "error",
            "sonarjs/argument-type": "error",
            "sonarjs/in-operator-type-error": "error",
            "sonarjs/array-callback-without-return": "error",
            "sonarjs/declarations-in-global-scope": "off",
            "sonarjs/function-return-type": "error",
            "sonarjs/no-inconsistent-returns": "off",
            "sonarjs/no-reference-error": "off",
            "sonarjs/super-invocation": "error",
            "sonarjs/no-all-duplicated-branches": "error",
            "sonarjs/no-same-line-conditional": "error",
            "sonarjs/conditional-indentation": "off",
            "sonarjs/no-collection-size-mischeck": "error",
            "sonarjs/no-unthrown-error": "error",
            "sonarjs/no-unused-collection": "error",
            "sonarjs/no-os-command-from-path": "error",
            "sonarjs/no-misleading-array-reverse": "error",
            "sonarjs/no-for-in-iterable": "off",
            "sonarjs/no-element-overwrite": "error",
            "sonarjs/no-identical-functions": "error",
            "sonarjs/no-empty-collection": "error",
            "sonarjs/no-redundant-assignments": "error",
            "sonarjs/prefer-type-guard": "error",
            "sonarjs/use-type-alias": "error",
            "sonarjs/no-return-type-any": "off",
            "sonarjs/no-implicit-dependencies": "off",
            "sonarjs/no-useless-intersection": "error",
            "sonarjs/weak-ssl": "error",
            "sonarjs/no-weak-keys": "error",
            "sonarjs/csrf": "error",
            "sonarjs/production-debug": "error",
            "sonarjs/prefer-default-last": "error",
            "sonarjs/no-in-misuse": "error",
            "sonarjs/no-duplicate-in-composite": "error",
            "sonarjs/max-union-size": "off",
            "sonarjs/no-undefined-argument": "error",
            "sonarjs/no-nested-template-literals": "error",
            "sonarjs/prefer-promise-shorthand": "error",
            "sonarjs/os-command": "error",
            "sonarjs/no-redundant-optional": "error",
            "sonarjs/regular-expr": "off",
            "sonarjs/encryption": "off",
            "sonarjs/hashing": "error",
            "sonarjs/bool-param-default": "off",
            "sonarjs/xpath": "off",
            "sonarjs/sockets": "off",
            "sonarjs/no-try-promise": "error",
            "sonarjs/process-argv": "off",
            "sonarjs/standard-input": "off",
            "sonarjs/unverified-certificate": "error",
            "sonarjs/no-unsafe-unzip": "error",
            "sonarjs/cors": "error",
            "sonarjs/link-with-target-blank": "error",
            "sonarjs/disabled-auto-escaping": "error",
            "sonarjs/table-header": "error",
            "sonarjs/no-table-as-layout": "error",
            "sonarjs/table-header-reference": "error",
            "sonarjs/object-alt-content": "error",
            "sonarjs/no-clear-text-protocols": "error",
            "sonarjs/publicly-writable-directories": "error",
            "sonarjs/unverified-hostname": "error",
            "sonarjs/encryption-secure-mode": "error",
            "sonarjs/no-weak-cipher": "error",
            "sonarjs/no-intrusive-permissions": "error",
            "sonarjs/insecure-jwt-token": "error",
            "sonarjs/x-powered-by": "error",
            "sonarjs/hidden-files": "error",
            "sonarjs/content-length": "error",
            "sonarjs/disabled-resource-integrity": "error",
            "sonarjs/content-security-policy": "error",
            "sonarjs/no-mixed-content": "error",
            "sonarjs/frame-ancestors": "error",
            "sonarjs/no-mime-sniff": "error",
            "sonarjs/no-referrer-policy": "error",
            "sonarjs/strict-transport-security": "error",
            "sonarjs/certificate-transparency": "off",
            "sonarjs/dns-prefetching": "off",
            "sonarjs/confidential-information-logging": "error",
            "sonarjs/no-ip-forward": "error",
            "sonarjs/empty-string-repetition": "error",
            "sonarjs/regex-complexity": "error",
            "sonarjs/anchor-precedence": "error",
            "sonarjs/slow-regex": "error",
            "sonarjs/no-invalid-regexp": "error",
            "sonarjs/unused-named-groups": "error",
            "sonarjs/no-same-argument-assert": "error",
            "sonarjs/unicode-aware-regex": "off",
            "sonarjs/no-misleading-character-class": "error",
            "sonarjs/duplicates-in-character-class": "error",
            "sonarjs/session-regeneration": "error",
            "sonarjs/test-check-exception": "error",
            "sonarjs/stable-tests": "error",
            "sonarjs/no-empty-after-reluctant": "error",
            "sonarjs/single-character-alternation": "error",
            "sonarjs/no-code-after-done": "error",
            "sonarjs/disabled-timeout": "error",
            "sonarjs/chai-determinate-assertion": "error",
            "sonarjs/aws-s3-bucket-server-encryption": "off",
            "sonarjs/aws-s3-bucket-insecure-http": "error",
            "sonarjs/aws-s3-bucket-versioning": "error",
            "sonarjs/aws-s3-bucket-granted-access": "error",
            "sonarjs/no-angular-bypass-sanitization": "error",
            "sonarjs/aws-iam-public-access": "error",
            "sonarjs/aws-ec2-unencrypted-ebs-volume": "error",
            "sonarjs/aws-s3-bucket-public-access": "error",
            "sonarjs/no-vue-bypass-sanitization": "off",
            "sonarjs/aws-iam-all-privileges": "error",
            "sonarjs/aws-rds-unencrypted-databases": "error",
            "sonarjs/aws-iam-all-resources-accessible": "off",
            "sonarjs/aws-opensearchservice-domain": "error",
            "sonarjs/aws-iam-privilege-escalation": "error",
            "sonarjs/aws-sagemaker-unencrypted-notebook": "error",
            "sonarjs/aws-restricted-ip-admin-access": "error",
            "sonarjs/no-empty-alternatives": "error",
            "sonarjs/no-control-regex": "error",
            "sonarjs/no-regex-spaces": "error",
            "sonarjs/aws-sns-unencrypted-topics": "error",
            "sonarjs/existing-groups": "error",
            "sonarjs/aws-ec2-rds-dms-public": "error",
            "sonarjs/aws-sqs-unencrypted-queue": "error",
            "sonarjs/no-empty-group": "error",
            "sonarjs/aws-efs-unencrypted": "error",
            "sonarjs/aws-apigateway-public-api": "error",
            "sonarjs/stateful-regex": "error",
            "sonarjs/concise-regex": "error",
            "sonarjs/single-char-in-character-classes": "error",
            "sonarjs/no-hardcoded-secrets": "error",
            "sonarjs/no-exclusive-tests": "error",
            "sonarjs/hardcoded-secret-signatures": "error",
            "sonarjs/jsx-no-leaked-render": "error",
            "sonarjs/no-hook-setter-in-body": "error",
            "sonarjs/no-useless-react-setstate": "error",
            "sonarjs/no-uniq-key": "error",
            "sonarjs/redundant-type-aliases": "error",
            "sonarjs/prefer-regexp-exec": "error",
            "sonarjs/no-internal-api-use": "error",
            "sonarjs/prefer-read-only-props": "error",
            "sonarjs/no-literal-call": "error",
            "sonarjs/reduce-initial-value": "error",
            "sonarjs/no-async-constructor": "error",
            "sonarjs/review-blockchain-mnemonic": "error",
            "sonarjs/dynamically-constructed-templates": "error",
            ...commonRules,
        },
        overrides,
    },
};
