name: Push ~ FOSSA update attribution file

on:
  push:
    branches:
      - master
      - release
    paths:
      - 'common/config/rush/pnpm-lock.yaml'

jobs:
    run-fossa-scan-update-attribution:
        name: Run FOSSA scan and update attribution file
        uses: ./.github/workflows/rw-fossa-update-attribution-file.yml
        secrets: inherit
        permissions:
          contents: write
          id-token: write
        with:
          source-branch:  ${{ github.event.ref }}

    notify-publish-failed-to-slack:
        if: ${{ always() && needs.run-fossa-scan-update-attribution == 'failure' }}
        needs: [run-fossa-scan-update-attribution]
        runs-on: [ubuntu-latest]
        steps:
          - name: Inform to slack when fossa workflows failed
            uses: slackapi/slack-github-action@v1.25.0
            with:
                channel-id: "#javascript-notifications"
                slack-message: ":warning: The FOSSA scan and attribution file creation failed. Check the *<${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}|log here>* for further information."
            env:
                SLACK_BOT_TOKEN: ${{ secrets.SLACK_BOT_TOKEN }}
