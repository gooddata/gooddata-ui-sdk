# (C) 2025 GoodData Corporation

services:
    backstop:
        image: 020413372491.dkr.ecr.us-east-1.amazonaws.com/pullthrough/docker.io/gooddata/gooddata-neobackstop:0.20.1
        volumes:
            - ./neobackstop/output:/usr/neobackstop/output
            - ./neobackstop/config.json:/usr/neobackstop/config.json:ro
            - ./neobackstop/scenarios.json:/usr/neobackstop/scenarios.json:ro
        command: ${COMMAND_ARGS}
        depends_on:
            - ag-grid.com
        networks:
            - isolated

    ag-grid.com:
        build:
            context: ./neobackstop/serve
            dockerfile: Dockerfile
        networks:
            - isolated
#        volumes:
#            - ./dist-storybook:/srv/storybook:ro # this is now copied in Dockerfile

# hide ag-grid watermark in tests by using isolated network and accessing storybook
# at http://ag-grid.com:8080 (see isDisplayWatermark() in ag-grid-enterprise.js)
networks:
    isolated:
        internal: true
