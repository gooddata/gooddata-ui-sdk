// (C) 2025 GoodData Corporation
@use "agVariables" as ag;

.gd-pivot-table-next {
    @include ag.ag-grid-theme-variables;

    --dash-border: 1px dashed var(--gd-table-gridColor);
    --solid-border: 1px solid var(--gd-table-gridColor);
    --transparent-border: 1px solid transparent;
    $root: &;

    width: 100%;
    height: 100%;

    .ag-row {
        border: none;
    }

    .ag-header {
        border-bottom: none;
    }

    .ag-header-span-height {
        border-top: none;
    }

    .ag-header-row:last-child > .ag-header-cell {
        border-bottom: var(--solid-border);
    }

    [row-index="0"] {
        .ag-cell {
            // stylelint-disable-next-line declaration-no-important
            border-top: none !important;
        }
    }

    .ag-header-cell,
    .ag-header-group-cell {
        border-bottom: var(--dash-border);
    }

    .ag-header-cell:hover,
    .ag-header-group-cell:hover {
        background-color: var(--gd-table-headerHoverBackgroundColor);
    }

    .ag-header-cell-resize {
        background: linear-gradient(to right, transparent 0%, #fff 50%, #fff 100%);
    }

    // aggrid css overrides for absolutely positioned header menu button
    // START
    .ag-header-cell-comp-wrapper {
        width: unset;
    }

    .ag-header-cell-label {
        overflow: visible;
    }

    .ag-header-cell-text {
        overflow: visible;
    }

    .ag-react-container {
        overflow: visible;
    }
    // END

    .gd-column-group-header {
        border-bottom: 1px dashed transparent;
        border-bottom-color: var(
            --gd-table-gridColor,
            var(--gd-palette-complementary-4-from-theme, rgba(176, 190, 202, 0.5))
        );
        // stylelint-disable-next-line declaration-no-important
        border-top: 2px solid red !important;
    }

    .ag-header-group-cell-with-group {
        border-left: 1px dashed transparent;
        border-left-color: var(--gd-table-gridColor);
    }

    .ag-header-row:not(:first-child) .ag-header-group-cell.ag-header-group-cell-with-group {
        border-top: var(--ag-borders-critical) var(--ag-border-color);
    }

    &__header-cell {
        border: none;
        align-items: center;

        &--attribute {
            text-align: left;
        }

        &--metric {
            text-align: right;
        }

        &--total {
            font-weight: bold;
            background-color: var(--gd-table-totalBackgroundColor);
        }

        &--subtotal {
            font-weight: bold;
            background-color: var(--gd-table-totalBackgroundColor);
        }

        &--first-of-group {
            // stylelint-disable-next-line declaration-no-important
            border-left: var(--dash-border) !important;
        }

        &.ag-column-first {
            border-left: none;
            border-top: none;
        }

        // Show menu button on hover or when a descendant has visible keyboard focus
        &:hover,
        &:has(:focus-visible) {
            #{$root}__header-cell-menu-button,
            #{$root}__header-cell-menu-button-wrapper {
                display: flex;
                align-items: center;
            }
        }

        // Keep hover background color when menu is open
        &:has(#{$root}__header-cell-menu--is-open) {
            background-color: var(--gd-table-headerHoverBackgroundColor);
        }
    }

    &__header-cell-menu {
        display: flex;
        align-items: center;

        // Keep the menu button visible while the menu is open
        &--is-open {
            #{$root}__header-cell-menu-button,
            #{$root}__header-cell-menu-button-wrapper {
                display: flex;
                align-items: center;
            }
        }

        // Enable text truncation when the header text is not text wrapping
        &--truncated {
            min-width: 0;

            > span {
                flex: 1 1 auto;
                min-width: 0;
                overflow: hidden;
                white-space: nowrap;
                text-overflow: ellipsis;
            }
        }
    }

    &__header-cell-menu-button {
        display: none;
        position: absolute;
        top: 0;
        bottom: 0;
        left: 0;
        z-index: 2;
        flex: 0 0 auto;
        background: none;
        border: none;
        padding: 0;
        margin: 0;
        cursor: pointer;
    }

    &__header-cell-menu-button-wrapper {
        display: none;
        position: absolute;
        top: 0;
        bottom: 0;
        left: 0;
        width: 24px;
        z-index: 3;
    }

    &__header-cell-menu-clickable-area {
        position: absolute;
        top: -132px;
        left: -10px;
        height: 264px;
        width: 34px;
        background: var(--gd-table-headerHoverBackgroundColor);
        z-index: -1;
        border-right: 1px solid var(--gd-palette-complementary-3);
    }

    &__header-cell-menu-button:hover {
        #{$root}__header-cell-menu-clickable-area {
            background: var(--gd-palette-primary-base-dimmed-darken03);
        }
    }

    &__header-cell-menu-section-header {
        position: relative;
        padding: 12px 12px 0;
        line-height: 16px;
        color: var(--gd-table-nullValueColor);
        font-size: 10px;
        text-transform: uppercase;
        cursor: default;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }

    &__header-cell-submenu-section-header {
        position: relative;
        padding: 12px 30px 0;
        line-height: 16px;
        color: var(--gd-table-nullValueColor);
        font-size: 10px;
        text-transform: uppercase;
        cursor: default;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }

    &__header-cell-submenu-section-icon {
        position: absolute;
        left: 10px;
        top: 12px;
    }

    // First header row
    .ag-header-row:first-child {
        #{$root}__header-cell {
            border-top: none;
        }
    }

    &__cell {
        border: none;
        border-top: var(--dash-border);

        &--drillable {
            font-weight: bold;
            cursor: pointer;
            color: var(--gd-table-valueColor);
        }

        &--drillable:hover {
            text-decoration: underline;
        }

        &--attribute {
            text-align: left;
            // stylelint-disable-next-line declaration-no-important
            border-left: none !important;
        }

        &--metric {
            text-align: right;
        }

        &--first-of-group {
            // stylelint-disable-next-line declaration-no-important
            border-left: var(--dash-border) !important;
        }

        &--separated {
            // stylelint-disable-next-line declaration-no-important
            border-top: var(--solid-border) !important;
        }

        &--grouped {
            border: none;
            // stylelint-disable-next-line declaration-no-important
            background-color: white !important;
        }

        &--null {
            color: var(--gd-table-nullValueColor);
        }

        &--total {
            font-weight: bold;
            color: var(--gd-table-totalValueColor);
            background-color: var(--gd-table-totalBackgroundColor);
            // stylelint-disable-next-line declaration-no-important
            border-top: var(--solid-border) !important;
        }

        &--subtotal {
            font-weight: bold;
            color: var(--gd-table-totalValueColor);
            background-color: var(--gd-table-totalBackgroundColor);
            border-top: var(--solid-border);
        }

        &--overall-total {
            font-weight: bold;
            color: var(--gd-table-totalValueColor);
            background-color: var(--gd-table-totalBackgroundColor);
            // stylelint-disable-next-line declaration-no-important
            border-top: var(--solid-border) !important;
        }

        &--total-header {
            font-weight: bold;
            color: var(--gd-table-totalValueColor);
            background-color: var(--gd-table-totalBackgroundColor);
            // stylelint-disable-next-line declaration-no-important
            border-top: var(--solid-border) !important;
            text-align: left;
        }

        &--column-total {
            font-weight: bold;
            color: var(--gd-table-totalValueColor);
            background-color: var(--gd-table-totalBackgroundColor);
            border-left: var(--solid-border);
        }

        &--column-total-within-row-total {
            border-top: var(--solid-border);
        }

        // Show measure in row header menu button
        &:hover,
        &:has(:focus-visible) {
            #{$root}__header-cell-menu-button,
            #{$root}__header-cell-menu-button-wrapper {
                display: flex;
                align-items: center;
            }
        }
    }

    // First cell row
    .ag-row-first {
        #{$root}__cell {
            border-top: none;
        }
    }

    // Avoid the body to grow to the height of the container
    // otherwise pinned rows are at the very bottom of the container
    .ag-body {
        flex: unset;
    }
}
